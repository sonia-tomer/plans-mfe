<div [style.background-image]="planPricingBgUrl" class="flex flex-col gap-4 max-w-7xl mx-auto mt-4 md:mt-8 px-4 md:px-8 lg:px-[50px]">

  <div class="">
    <div class="mb-10">
      <div
        class="mx-auto mb-6 md:mb-8 max-w-[553px] min-h-[36px] text-center text-lg md:text-[24px] leading-[150%] font-bold sf-pro-bold flex items-center justify-center px-4"
      >
      <span class="bg-gradient-to-r from-[#0B2110] via-[#4E3AA9] to-[#735AE5] bg-clip-text text-transparent">Choose a pricing plan that fits your business needs</span>
      </div>

      <!-- Sample shipment info (Tailwind-only layout) -->
      <div
        class="w-full border border-[#EDEFF7] shadow-[0px_4px_28px_rgba(0,0,0,0.04)] rounded-xl bg-white box-border"
      >
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between h-full px-4 py-3 gap-0 md:gap-2">
          <div class="flex flex-col gap-2 flex-1 min-w-0">
            <div class="flex items-center">
              <span class="sf-pro-medium font-semibold text-[14px] leading-5 text-[#0E2D57]">
                Sample shipment details to calculate your average shipment cost*
              </span>
            </div>
            <div
              class="flex flex-wrap items-center gap-1 md:gap-2 text-[11px] md:text-[12px] leading-4 text-[#6B7280] sf-pro-regular"
            >
              <span>Weight : <span class="text-[#111827]">{{ shipmentDetails().weight }}</span></span>
              <app-cdn-icon name="dot" [width]="5" [height]="5"></app-cdn-icon>
              <span>Payment : <span class="text-[#111827]">{{ shipmentDetails().payment.toLowerCase() }}</span></span>
              <app-cdn-icon name="dot" [width]="5" [height]="5"></app-cdn-icon>
              <span>Mode : <span class="text-[#111827]">{{ shipmentDetails().mode.toLowerCase() }}</span></span>
              <app-cdn-icon name="dot" [width]="5" [height]="5"></app-cdn-icon>
              <span>Pickup Pincode : <span class="text-[#111827]">{{ shipmentDetails().pickupPincode }}</span></span>
              <app-cdn-icon name="arrow-right" [width]="10" [height]="5"></app-cdn-icon>
              <span>Delivery Pincode : <span class="text-[#111827]">{{ shipmentDetails().deliveryPincode }}</span></span>
            </div>
          </div>

          <div class="flex items-center h-6">
            <button
              (click)="openEditShipmentModal()"
              class="flex items-center gap-2 text-[14px] leading-6 sf-pro-medium font-semibold text-[#735AE5] hover:opacity-80 active:opacity-60"
            >
              <app-cdn-icon name="edit-pen" [width]="20" [height]="20"></app-cdn-icon>
              <span>Edit</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="min-h-[720px]">
      @if (!loading()) {
      <div class="pricing-cards-container">
        <div class="pricing-cards-wrapper min-w-[1000px] lg:min-w-0">
        @for (plan of plans(); track plan.id) {
        <div class="pricing-plan-card" [class.pricing-plan-card-current]="plan.isCurrentPlan">
        <!-- CURRENT PLAN Label -->
        @if (plan.isCurrentPlan) {
        <div class="pricing-plan-current-label">CURRENT PLAN</div>
        }
        <!-- RECOMMENDED Icon -->
        @if (plan.isRecommended) {
        <div class="pricing-plan-recommended-icon">
          <app-cdn-icon name="recommended" [width]="120" [height]="20"></app-cdn-icon>
        </div>
        }
        <!-- Plan Card Inner Container -->
        <div class="pricing-plan-card-inner p-3" [class.pricing-plan-card-inner-current]="plan.isCurrentPlan">
          <!-- Plan Header Section -->
          <div class="pricing-plan-header">
            <div class="pricing-plan-title-section">
              <h2 class="pricing-plan-name">{{ plan.name }}</h2>
              <div class="pricing-plan-price-section">
                <div class="pricing-plan-price">{{ plan.priceDisplay }}</div>
                <div class="pricing-plan-description" [innerHTML]="getSafeHtml(plan.description)"></div>
              </div>
            </div>

            <!-- Average Shipment Cost -->
            <div class="pricing-plan-avg-cost">
              <div class="pricing-plan-avg-cost-label">Avg shipment cost*</div>
              <div class="pricing-plan-avg-cost-value">
                <span class="pricing-plan-avg-cost-amount">â‚¹{{ plan.avgShipmentCost }}</span>
                <div class="pricing-plan-avg-cost-line"></div>
              </div>
            </div>

            <!-- Plan Features -->
            <div class="pricing-plan-features">
              <div class="pricing-plan-features-label">Includes:</div>
              <ul class="pricing-plan-features-list">
                @for (feature of plan.features; track feature.text) {
                <li class="pricing-plan-feature-item">
                  <app-cdn-icon [name]="feature.icon" [width]="12" [height]="12"></app-cdn-icon>
                  <span class="pricing-plan-feature-text">{{ feature.text }}</span>
                </li>
                }
              </ul>
            </div>
          </div>

          <!-- Gift Box Section -->
          @if (plan.milestoneMatrix) {
            <div
              class="box-border flex flex-col items-start gap-1 mx-auto px-3 py-4 border border-[#DEEBFF] rounded-[10px]"
              style="background: linear-gradient(270deg, #FFFFFF 3.62%, #EAF6FF 100%);"
            >
              <div class="w-4 h-4">
                <app-cdn-icon name="gift" [width]="16" [height]="16"></app-cdn-icon>
              </div>
              <div class="sf-pro-regular text-[12px] leading-[150%] text-[#373B62]">
                @if (plan.milestoneMatrix.offerDetailsHtml) {
                  <span [innerHTML]="getSafeHtml(plan.milestoneMatrix.offerDetailsHtml)"></span>
                }
                <div
                  class="text-[#3887FF] sf-pro-medium cursor-pointer"
                  (click)="openZeroFeeOfferModal(plan)"
                >
                  know more
                </div>
              </div>
            </div>
          }

      
          <div class="pricing-plan-renewal-date mx-auto">Next renewal: {{ plan.nextRenewalDate }}</div>
          

          <!-- Action Section -->
          <div class="pricing-plan-actions">
            @if (!plan.isCurrentPlan) {
            <button class="pricing-plan-activate-btn" (click)="activatePlan(plan)">
              Activate
            </button>
            }
            @if (plan.isCurrentPlan) {
            <div class="pricing-plan-renewal-section">
              @if (plan.nextRenewalDate) {
              <div class="pricing-plan-renewal-date">Next renewal: {{ plan.nextRenewalDate }}</div>
              }
              <button class="pricing-plan-activate-btn pricing-plan-active-btn" disabled>
                <app-cdn-icon name="green-tick" [width]="15" [height]="15"></app-cdn-icon>
                <span>Active</span>
              </button>
            </div>
            }
            <a href="#" class="pricing-plan-rate-card-link" (click)="viewRateCard(plan); $event.preventDefault()">
              <span>View detailed rate card</span>
              <div class="pricing-plan-rate-card-line"></div>
            </a>
          </div>
          </div>
        </div>
        }
        </div>
      </div>
      } @else {
      <!-- Skeleton loader: matches grid + card footprint to avoid layout shift -->
      <div class="pricing-cards-container">
        <div class="pricing-cards-wrapper animate-pulse min-w-[1000px] lg:min-w-0">
        @for (i of [0,1,2,3]; track i) {
        <div class="pricing-plan-card">
          <div class="pricing-plan-card-inner">
            <div class="pricing-plan-header">
              <div class="pricing-plan-title-section">
                <div class="h-5 w-32 bg-gray-200 rounded mb-2"></div>
                <div class="pricing-plan-price-section">
                  <div class="h-6 w-24 bg-gray-200 rounded mb-2"></div>
                  <div class="h-10 w-40 bg-gray-100 rounded"></div>
                </div>
              </div>
              <div class="pricing-plan-avg-cost">
                <div class="h-4 w-28 bg-gray-200 rounded mb-1"></div>
                <div class="pricing-plan-avg-cost-value">
                  <div class="h-6 w-12 bg-gray-200 rounded mb-1"></div>
                  <div class="pricing-plan-avg-cost-line"></div>
                </div>
              </div>
              <div class="pricing-plan-features">
                <div class="h-4 w-20 bg-gray-200 rounded mb-1"></div>
                <ul class="pricing-plan-features-list">
                  @for (j of [0,1,2]; track j) {
                  <li class="pricing-plan-feature-item">
                    <div class="w-3 h-3 bg-gray-200 rounded-full"></div>
                    <div class="h-4 w-32 bg-gray-200 rounded"></div>
                  </li>
                  }
                </ul>
              </div>
            </div>
            <div class="pricing-plan-actions mt-4">
              <div class="w-[207px] h-[34px] bg-gray-200 rounded-md"></div>
            </div>
          </div>
        </div>
        }
        </div>
      </div>
      }
    </div>

    <!-- Large Business Section -->
    <div
      class="w-full mx-auto border border-[#EDEFF7] shadow-[0px_2px_12px_rgba(0,0,10,0.02)] rounded-xl py-4 md:py-6 px-4 md:px-6 bg-white relative overflow-hidden"
      [style.background-image]="largeBusinessBgUrl" [style.background-size]="'cover'">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <!-- Text Content -->
        <div class="flex flex-col gap-4 flex-1">
          <h3 class="sf-pro-bold font-bold text-lg md:text-2xl leading-[120%] text-[#06064D]">
            Running a large business that ships 10,000+ orders a month?
          </h3>
          <p class="sf-pro-regular font-normal text-base leading-6 text-[#6B7280]">
            Tailored pricing and support for your business at
          </p>
        </div>

        <!-- Button -->
        <button (click)="openContactSalesModal()"
          class="w-full md:w-auto flex flex-row justify-center items-center px-5 py-3 gap-2 bg-[#735AE5] hover:bg-[#6349d4] rounded-md sf-pro-medium font-semibold text-sm text-white whitespace-nowrap transition-colors">
          Contact Sales
        </button>
      </div>
    </div>
  </div>
  
  <!-- Understand Shipping Cost Section (deferred, below-the-fold) -->
  @defer {
    <div class="w-full max-w-[1164px] mx-auto px-0 md:px-4 mt-0 md:mt-6 rounded-xl">
      <div
        class="min-h-[276px] flex justify-center items-center px-4 md:px-10 py-4 bg-white shadow-[0px_0px_6px_rgba(0,0,10,0.04)] rounded-xl"
      >
        <div
          class="w-full min-h-[226px] bg-white shadow-[0px_0px_6px_rgba(0,0,10,0.04)] rounded-xl relative overflow-hidden"
        >
          <div
            class="absolute inset-0 flex flex-col justify-center items-center py-6 gap-4 px-4 md:px-[45px]"
            style=" border: 1px solid #EDEFF7; box-shadow: 0px 2px 12px rgba(0, 0, 10, 0.02); border-radius: 12px;"
            [style.background-image]="calculatorBgUrl"
          >
            <div class="flex flex-col items-center gap-2 w-full max-w-[688px] z-10">
              <app-cdn-icon name="calculator" [width]="56" [height]="56"></app-cdn-icon>
              <h3 class="sf-pro-bold font-bold text-lg md:text-2xl leading-[120%] text-center text-[#06064D]">
                Understand your shipping cost better
              </h3>
              <p class="sf-pro-regular font-normal text-sm md:text-base leading-[130%] text-center text-[#6B7280]">
                Use the calculator below to share your shipment breakdown and get the average monthly shipping cost
              </p>
            </div>
            <button
              class="flex flex-row justify-center items-center px-5 py-3 gap-2 bg-white border border-[#735AE5] rounded-md sf-pro-medium font-semibold text-sm text-[#735AE5] hover:bg-[#F6F4FF] transition-colors z-10"
            >
              Calculate average shipment cost
            </button>
          </div>
        </div>
      </div>
    </div>
  }
  
  <!-- Features Section (deferred, below-the-fold) -->
  @defer {
    <app-features-section></app-features-section>
  }
  
  <!-- Integration Section (deferred, below-the-fold) -->
  @defer {
    <app-integration-section></app-integration-section>
  }
</div>
